AT_BANNER([journal])

AT_SETUP([enable and disable journal])
AT_DATA([journal.sps], [dnl
set journal='pspp.jnl' on.
data list notable /x y 1-2.
begin data.
12
end data.
set journal=off.

print.

execute.
set journal=on.
])

AT_CHECK([pspp journal.sps])
AT_CHECK([sed 's/ at.*/./' pspp.jnl], [0], [dnl
* New session.
set journal='pspp.jnl' on.
data list notable /x y 1-2.
begin data.
12
end data.

* New session.
set journal=on.
])
AT_CLEANUP

AT_SETUP([journal disabled by default non-interactively])
AT_DATA([journal.sps], [dnl
data list notable /x y 1-2.
])
AT_CHECK([XDG_STATE_HOME=$PWD pspp journal.sps])
AT_CHECK([test ! -e pspp/pspp.jnl])
AT_CLEANUP

AT_SETUP([journal enabled by default interactively])
AT_SKIP_IF([test "$SQUISH_PTY" = no])
AT_CHECK([echo 'data list notable /x y 1-2.
finish.' | XDG_STATE_HOME=$PWD $SQUISH_PTY pspp], [0], [ignore])
AT_CHECK([sed 's/New session at .*/New session./' pspp/pspp.jnl], [0], [dnl
* New session.
data list notable /x y 1-2.
finish.
])
AT_CLEANUP
