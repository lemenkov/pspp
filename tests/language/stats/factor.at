dnl PSPP - a program for statistical analysis.
dnl Copyright (C) 2017 Free Software Foundation, Inc.
dnl
dnl This program is free software: you can redistribute it and/or modify
dnl it under the terms of the GNU General Public License as published by
dnl the Free Software Foundation, either version 3 of the License, or
dnl (at your option) any later version.
dnl
dnl This program is distributed in the hope that it will be useful,
dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
dnl GNU General Public License for more details.
dnl
dnl You should have received a copy of the GNU General Public License
dnl along with this program.  If not, see <http://www.gnu.org/licenses/>.
dnl
AT_BANNER([FACTOR procedure])

AT_SETUP([FACTOR extraction=paf method=correlation])
dnl This example is based on data from http://www.ats.ucla.edu/stat/Spss/output/factor1.htm

AT_DATA([factor.sps],
  [set format = F11.3.

data list notable fixed /question13 to question24 1-12.
begin data.
555555535543
544453434443
545555544444
444442444433
554545554554
554455454455
555554555244
554455544443
555554434344
544454544344
555545555555
555454544455
555445544455
455544443343
544454344344
555555555455
555554454455
555555554445
555555554555
545534553343
555555535554
555544444445
545544334433
554555434443
555555544454
555445545453
555554434244
444444433233
545555454443
554443434243
444534334333
454534444332
555455353444
555544443243
555554543243
555544444343
445444434443
555555555544
444444434340
455044434334
555555533433
554554535040
434533334232
443232444432
555555555555
555555554544
555544444445
444224343344
444554454355
444434332433
555555555555
043243432433
444443334333
453443433434
443342332232
554434434533
444344434443
444444434443
554552434133
453334332432
444445554444
431232332223
555555555544
544445543443
444455535543
444444444433
444444543243
555431443333
444443433433
444433433443
454334444433
111111111544
444423442433
555443333353
555543334344
055454400000
555454444355
555555555555
055544533333
555554555554
555555535554
555555545355
555555555455
555544545543
555554404455
555454435454
555555535554
555555555555
555443433544
555554435454
555555545344
555555535454
555445535453
444444333544
555554434444
455454434454
555555535555
554545534455
555555555443
454443434444
555553334444
555554545454
555555555555
555554554454
555555555555
544545534544
555555534454
555555555455
555554535544
555555535555
555451234443
555444444544
555544434354
555545533444
555554534443
545554434554
554433444433
544432233524
411111111111
445423442233
555543433344
444443342233
555555534455
545442434223
554553352333
544554554445
555555435455
444334304234
455453444434
444443443245
555552232132
555434324345
544444434344
534344344444
445555555344
444343442132
444444434344
444444554334
444545444333
434442343224
443443433233
555551555554
544544434444
454544434433
555555535434
555555555555
455544444444
454444434233
555555544344
454445544445
444444554434
555455455443
555454425444
444454434443
544443433233
444543434433
555553545354
544444444433
444445434433
555533353333
555434234333
444314222411
555555555555
455545534443
455045534433
555545444444
455544243543
444421113343
554444534444
555555544554
555334434452
555544543455
555554434554
555445554454
555555545344
555555555555
554543334245
554441233333
555554334545
555555535544
555555554554
555445444543
444424544432
444425544333
555434344443
555533233223
544433442343
555555555555
555445452234
555444555444
555444544455
555544354554
545445555555
555555555555
455443342232
555555544454
455534443455
555555555055
444554333244
444445434543
555554544455
444443444434
444444434445
334231314323
444444434433
555554444443
444444434443
555455434444
444444444444
555455435455
444444434344
444543433232
544443334454
555544433244
534443324224
555555544444
444443434444
555553444344
443434443333
444444434333
554445444343
444443344434
445555544543
555554443443
322232403322
444444444433
444445444443
444454534445
544344444344
554445534544
555555555554
555544432333
444444444443
555555555554
455555555554
555555555543
555555555544
555554445555
444335544455
555555555555
555454444454
555455544454
444445444444
555555555555
555455454554
555454544554
555555555455
555555554444
444444544434
334334443333
422224222211
121512011111
443444432332
434335533344
444443543433
554454443453
555555545454
555555555344
555555555554
555555334555
454445554444
454545534444
555554555444
455444534455
555544554544
444444444444
555424423133
222433443224
544544532344
545554544544
555532544144
444432343433
434545554545
444344505443
555555555544
555554555344
444531113112
555554333133
455433233233
354354434345
454534433433
433112332321
555445433333
454343434143
555554445555
455423334322
443333332222
444443444443
553432224134
444223432233
454324425444
344434514443
555552415255
354332543353
444531333233
443433334133
444444444433
444444445533
445133212223
343433432213
442333333332
345455535244
443211121122
555445444444
555555544344
453243332232
443543422533
554444434344
554444333444
555555335343
444231121133
454433332233
455524434244
554433224354
555455555444
454444424444
554242232134
555553315443
555553333454
455421434211
111111151111
454443203123
454243334132
355332213144
554534334134
555543434355
555543433255
444441223334
555443143255
444444444454
444442323544
454443434343
445453434444
454455554433
554532342234
444442243233
444442343334
555443433444
555543253444
554554444455
555543355344
555444445444
434443204222
444432444234
222142441111
111111141111
334334454433
555354552543
433411122112
455534504444
543211224233
344333332532
344443233333
444424432434
555555544454
555555554544
555444444444
555443533443
555554544344
555554444444
544543433343
444445434444
555555555555
555443333233
545444534454
555454434343
555453434544
544334444333
555443443444
555555534544
444444444433
555543433343
555444445334
555543442433
455444334443
554443434443
555254500544
555444433344
555555535544
444443532232
544443433433
555555535544
555455454444
555455445544
544444534433
555555555554
555553533444
555555555554
555554434343
555455544443
555554444443
555454444445
333222333223
444443544233
543443534433
555545454533
444444404033
455454504543
455555555454
454443344343
555553435244
555543544444
555553343044
444443444433
445543434434
555554433545
555554455445
455553333234
555552344243
444141212213
444443504234
445544253444
555554354555
534552234543
555554544544
444233404224
555554534444
444443444344
422442434324
554434434344
444444434334
443433432444
555454435344
252423332214
454544434434
444444444244
555554544445
443222432333
555544444332
545555543445
554544334444
555445555544
554343434433
555555535554
444554444333
553544343534
555553254433
555555554554
544443443344
555443444344
544432144123
555555555555
555555555354
555555535545
455454434444
455455534445
455555554455
555553545445
445545544444
545345553555
444445444433
443435433433
555554545353
444443232223
444444434433
555555545454
555554444343
555554444443
434544333422
444443434343
555555455443
555544434343
455545534444
555555555553
444443343434
555555555445
433444444434
344221512132
333421132223
333444443444
435544545533
444335544443
333323223323
334434332333
444422323213
324433443423
555555554555
555452424444
555544434444
555544443343
555445545453
555555344453
555544545550
454443434334
444332233344
555554332344
554444433444
555554555554
555555543544
444442443132
555555545555
544553435533
044044444444
444443434533
555454433434
555555555454
555555555555
454544434444
444444434333
554555455554
555555543444
423331124132
445445534455
555555555554
444535554434
555555555554
354443422232
555545535443
555555555555
555455444453
455434443333
455444443233
343322434411
555555555534
453442432333
445554434544
345444443333
454554554355
444434453434
555555454443
555443343341
545553343433
222343222201
444433434443
535555555544
552541442423
545433343334
455445433443
444444433433
455543343433
434444432333
444545444444
555554534444
452444434433
454443432533
555453334433
444442233432
555555553433
545555545445
335543222333
554554344445
243424442212
133222432411
343434534233
222222212211
445455554434
455554453344
223334424434
555355555544
455544554434
544455555444
444444444444
444444444344
444334444444
444444444434
555455534243
555555545555
555555555555
444443534343
555554544444
555555555454
444434433433
455445544444
555544544455
444333433333
455443445343
444432442444
443334451543
555554455555
555444444444
555555555455
555555555554
555454345154
555555555555
555555555455
555554454544
454444454544
554443334544
455555402535
555554531534
455545544554
444423444223
555444334533
455554445243
453444334344
555555555554
555555555455
555555555554
455443334344
555555253555
555554433454
555444344455
550030034433
555444233343
555343222133
555555555554
555555243243
555555555355
555554345555
555443434454
545543133133
555443334154
444444344454
555555242254
555554444344
545443334454
554444132454
555455143154
555554453044
555555555455
555534335454
555555245555
545543333444
555555355454
555353145133
555553043454
555555354554
555543434454
555444324454
444444203443
555552233355
555555445455
555500034354
555354354444
555555555555
555543334144
555555005254
454444344254
555555555554
555555555255
555555555455
444444242243
555554445154
444444234333
555555553455
444422224243
555545443344
545552133143
555455044344
555555455555
555555545454
454433343144
555555555555
555455255155
555555454455
555555424455
555555355555
555444444455
555555454455
544411211314
223322441123
444223434233
444441121232
555555535555
454445533444
434442434433
545355554454
555542544333
445545555444
321000001011
444444444444
333223321322
444232433233
425432523122
455555555544
555555545555
555555534354
554554444243
555554343443
444443434333
555224252443
555544433433
344544434423
555554434344
555542134233
444344434444
445443433233
455343333434
455443333445
355344434433
234234433333
445444444445
455535535545
443423234443
455544334544
345441333323
445444533433
455554443355
445444433243
455454453444
444244444444
554244544154
555555555555
454343444444
555444444344
545455534454
555555555555
555554534454
555254555444
544354544453
553454534445
555454445355
545253554454
433342322233
544444444443
555455445544
424322433233
444424222233
555355555544
000000000000
555455345344
000055505450
434333444333
444445444444
555555555545
555554455545
555455435533
544544444243
444331232323
555555554444
443332323233
444224342433
555555555544
433443342333
555445504554
555545555544
555555535555
555555535345
454443433333
555444444555
444443232435
555433444443
555443434543
555555535555
555555533544
555543234444
433432332221
443433544233
443443333334
444424433444
552444333123
233332232211
223422221122
434433414133
332323333102
552544223222
542423343232
555552534132
455554544134
433523533132
433333433433
435434543333
434553433444
555544434345
443543443433
555555542344
544444553144
555544544243
535443441342
344555444333
444444443333
443443433432
545554534544
443533433433
333443432223
333333433123
322432122213
555555555555
554555444433
444543443234
444444433433
452555534433
244444444233
433442422232
555555535555
555555554455
555554545244
555555355455
555555555555
555555555555
444433323233
555455455455
434445444433
555554444455
454444543445
555555535455
555545554455
555555555555
555555555555
555443344353
455543304132
444443444433
555555555355
434433443333
444434444433
444444444433
555555555555
445553443323
445444444444
555554444054
455555554543
555555535555
555554445454
555444444443
555555555454
555554344455
555555454454
554444444454
555555555353
555545544454
553545332223
444424444332
545555543433
555444433444
555555444445
444444424433
444444543434
124113531311
555554534543
555343333333
545444544344
555444534444
555544543444
555455544443
444324402121
555554534544
555455544444
555555544454
444334404433
555443534444
555545554444
555555555555
455333233433
455444433433
455444444444
444235442443
555443343433
444445453444
454345453432
555555453444
344433322323
444443444244
444442343133
554445432233
555555544444
555555534444
555554455554
454443334244
544443333233
444445534445
444432134121
555555332243
555555544433
555554434444
454543534233
454432432343
444424432433
545553335344
555443434344
454443433333
555553534444
554544434355
552532421235
454543433434
544544343234
555552334125
555543455555
443442334222
554443444344
555554543334
555552342444
554443433333
443444434445
555554533344
442412242121
454543343244
445554433344
444443333433
444443433333
444433333334
444444334444
432321102223
444444434443
444444434343
454531432331
445543433434
554554434554
334253232333
444443434244
444433443234
444433334334
444443433333
553434303222
454443434244
444445544444
443441133433
444432232133
444444404344
444444333243
455543124243
555544532344
444432333132
554553434244
454443443333
433111121111
555555555544
444432433222
444443433233
443332332133
445344453243
444444405434
554554434343
455344534443
444444400434
444444344344
544554533443
555554443455
555555544544
555554534444
323123232311
444344344443
555554555544
343323332333
444443434444
444442214340
555434434444
455543343444
445432434433
455553434455
243321332322
444422332332
555533454444
555544443433
354422431422
333322421211
444443432434
344422431322
333342222321
444443454433
443443444433
553434531334
554434552343
545455553544
554455554443
555555555533
555555554543
454454544433
555444532143
554545544443
444233442434
544444434234
554344432233
555345533355
554554544433
455444444344
555554554554
555554545555
444433534434
444444421134
334333333333
334443443343
122333441413
434444333333
444344433233
444333332143
555154344133
324344333223
244444402233
454443433543
444344433344
455555445555
555555544433
454544434443
344535554533
333435443433
444444554544
343434443333
544553544455
555444444455
244333332222
333441232233
544433433433
555544343344
344211142124
442442232113
433432332223
333424322222
444443333233
344321232223
442434342422
545555535555
455454434454
455355544444
454444444445
555554432430
555444344144
455534342234
555555554354
213332443111
555545434433
555554424444
443434443433
555555554443
555555555544
435535554433
555455545443
555555554533
554545443455
555553333233
434432232323
443443333433
443544231534
434533334334
555555535544
555544444445
555555555555
555555555555
555555555555
555555555555
544555544544
555555545555
545555534354
445444344344
555555555555
444443343334
555444440000
555555555554
555555545455
454434444345
555445544443
555554535433
454445555555
555444444355
555555555555
555555555555
555555555555
555555554555
555455554455
454435544255
545543342243
555544355345
555555455354
435553244333
555555443454
444444433445
121422433111
555554543244
555444554444
444203444433
344342553322
554445554344
545445454454
444245504233
334335555533
554355544444
444445545444
555555555344
454544543233
444455532434
555544354243
535444554433
444444444444
455555553243
244442343235
554544504043
444435553433
455553434354
555444343314
555553344453
555555555544
544444444433
434434550033
555455544444
455445534344
454445444554
555555555555
555555555555
555555555454
555455545412
334433343132
555454455455
555554454443
555555555555
555555553433
555555555555
555555445555
555545445455
555555545554
555555555555
445455554443
555445554433
555555554445
555553333144
555554455143
554454445444
555555554533
334422433422
555554434444
433531133222
443432342224
555544554433
553434333333
555543334443
444443344323
555555555555
555554545344
555555545554
555342434333
444443333233
444544435444
555555555555
555455554354
555555405054
555555555555
554555545545
555555555544
555545454344
555555455555
433444444343
454555554444
453555554544
444445554444
544455555455
555343434343
555553444454
555444434443
555555555444
555555545443
555444534455
555555555555
444443443434
555445533543
555555555444
555544444354
445444544243
555554555455
555555455444
555555555544
555555555454
554445545454
555555555543
344444434443
555555454453
455444443433
344244434433
355234452132
555445545455
444444444444
455444454433
555555555555
344233341155
333334433233
444433434333
444233443334
454344544444
555554245253
444444333344
554544434333
555444443343
555554555445
005555555544
554444445244
555455555555
555555555444
444444444433
555555555444
555555544454
555555555544
444444434444
555555535553
545534543334
554554534533
555555555554
554554544544
454541231221
555555535544
445344334432
444444344333
555555534444
555555545555
443434544232
545544433343
343234434333
444444443233
555454444455
555455535455
554433442243
444444544454
554545554544
454444444444
554455534455
555555544355
555445555555
555444534444
455454534444
555555555544
444444444455
454455554344
443244442233
350554554434
455444535343
344233443433
454444535545
244222232232
245345554344
355344444443
555455555444
444434444233
334323444322
333234443233
455455554454
555554544434
555355555444
444444544443
555554555544
344231224131
444443434433
454344444431
555554555553
454544444443
444443443532
334323423222
455555545554
555542434443
554444444443
554444534344
555443454555
555555534554
444434443343
444234432233
334323311333
444443443233
355424552242
233335323322
234233443333
123353532334
444345555244
332222433422
545445555443
555555555555
555554444443
455445554455
455455555455
555555555555
444443433445
555455555544
355453434232
555555554344
444433433433
434322242112
444444433433
444445444544
555444535444
544444444443
454544344334
454444334333
434433433332
334434423423
444455552233
442442342233
445433433343
555555444355
555555555555
455554555545
555445544444
544444434443
555555535333
554444444344
555554554445
345433334121
555555555554
545444444233
555555544455
555554545555
555555455555
555555545555
555554544455
444444444333
544544544445
555445544544
555455444455
555455555454
554455535444
453423442244
444443444444
454444333333
555555555542
555555555543
555555555544
555555535534
555555555444
444443423333
555444444444
555445544453
444444444443
555555443444
444443444333
554554154344
555543353333
554445443333
555555553455
554534444243
554555554545
555544443443
555554555555
555425552422
555555555555
454421121321
555454453433
555555554443
244224431223
455444453444
454345544455
344235545044
555555555544
555553325554
554554444244
555545544544
454555554545
444444545444
545544444455
454344445443
545555554453
444444444443
545554554453
555453434444
005434434454
455555455544
555555555554
455542444433
545543444555
445545445444
555553325454
555554555554
444544444443
555555444454
443332443222
454444443444
344333433332
555455444455
555555555445
555555534454
445433432343
555554434444
555555545444
544545434455
454435543444
555555555555
555455554555
555555544554
555553554455
555555555555
545454545444
555555445555
554534343444
555545443343
545454334444
554445544544
555455354344
555555555355
554445544354
455554444444
555555553543
555554444444
555543233444
555554344433
333334441223
543554344434
055541243244
555555555544
555555533444
555445444544
444335343433
544434344333
544435533333
444444443333
555555555554
555552343233
444444444433
544444434444
555555545555
555555555554
445244434444
445444434444
445555554521
443444543343
444433343434
355444433442
555543444455
555444334544
555555555555
554555545555
555555554555
555555555555
454444343445
444444433444
354445443444
555334242132
455445555543
254153343433
354244443333
554455444344
343255535444
455454555553
555455545555
444343433343
343323443323
455444444424
555544444455
343434543444
555555555544
555554534243
555554543344
555455555544
555443344343
444445533133
555543534555
444554444444
444002323320
444232322222
244344424441
555443344334
555555555555
555444534443
555555555555
555555555550
455555554555
555555555555

end data.

missing values
	question13 question14 question15 question16 question17 question18 question19 question20 question21 question22 question23 question24 (0).

factor
 /variables question13 question14 question15 question16 question17 question18 question19 question20 question21 question22 question23 question24
 /analysis all
 /print univariate det correlation
 /format blank(.30)
 /plot eigen
 /criteria factors(3)
 /extraction paf
 /method = correlation.
])

AT_CHECK([pspp -O format=csv factor.sps], [0],
  [Table: Descriptive Statistics
,Mean,Std. Deviation,Analysis N
question13,4.462,.729,1365
question14,4.525,.700,1365
question15,4.445,.732,1365
question16,4.281,.829,1365
question17,4.166,.895,1365
question18,3.930,1.034,1365
question19,4.077,.963,1365
question20,3.777,.909,1365
question21,3.774,.984,1365
question22,3.607,1.116,1365
question23,3.813,.957,1365
question24,3.666,.926,1365

Table: Correlation Matrix
,,question13,question14,question15,question16,question17,question18,question19,question20,question21,question22,question23,question24
Correlation,question13,1.000,.661,.600,.566,.577,.409,.286,.304,.476,.333,.564,.454
,question14,.661,1.000,.635,.500,.552,.433,.320,.315,.449,.333,.565,.443
,question15,.600,.635,1.000,.505,.587,.457,.359,.356,.509,.369,.582,.435
,question16,.566,.500,.505,1.000,.586,.405,.335,.317,.452,.363,.459,.430
,question17,.577,.552,.587,.586,1.000,.555,.449,.417,.595,.450,.613,.521
,question18,.409,.433,.457,.405,.555,1.000,.627,.521,.554,.536,.569,.474
,question19,.286,.320,.359,.335,.449,.627,1.000,.446,.499,.484,.444,.374
,question20,.304,.315,.356,.317,.417,.521,.446,1.000,.425,.383,.410,.357
,question21,.476,.449,.509,.452,.595,.554,.499,.425,1.000,.507,.598,.500
,question22,.333,.333,.369,.363,.450,.536,.484,.383,.507,1.000,.493,.444
,question23,.564,.565,.582,.459,.613,.569,.444,.410,.598,.493,1.000,.705
,question24,.454,.443,.435,.430,.521,.474,.374,.357,.500,.444,.705,1.000
Caption: Determinant: 0.00

Table: Factor Matrix
,Factor,,
,1,2,3
question13,.713,.398,
question14,.703,.339,
question15,.721,,
question16,.648,,
question17,.783,,
question18,.740,-.345,
question19,.616,-.415,
question20,.550,,
question21,.732,,
question22,.613,,
question23,.819,,.345
question24,.695,,.386

Table: Rotated Factor Matrix
,Factor,,
,1,2,3
question13,.771,,
question14,.726,,
question15,.676,,
question16,.591,,
question17,.587,.446,
question18,,.739,
question19,,.727,
question20,,.540,
question21,.402,.533,.321
question22,,.559,
question23,.449,.377,.668
question24,.324,.321,.652
])

AT_CLEANUP

AT_SETUP([FACTOR extraction=pc method=correlation])
dnl This example is from http://www.ats.ucla.edu/stat/spss/whatstat/whatstat.htm

AT_DATA([factor2.sps],
  [set format = F11.3.


data list notable list /id female race ses schtyp prog read write math science socst.
begin data.
 70.00      .00  4.00     1.00     1.00     1.00    57.00    52.00    41.00    47.00    57.00
121.00     1.00  4.00     2.00     1.00     3.00    68.00    59.00    53.00    63.00    61.00
 86.00      .00  4.00     3.00     1.00     1.00    44.00    33.00    54.00    58.00    31.00
141.00      .00  4.00     3.00     1.00     3.00    63.00    44.00    47.00    53.00    56.00
172.00      .00  4.00     2.00     1.00     2.00    47.00    52.00    57.00    53.00    61.00
113.00      .00  4.00     2.00     1.00     2.00    44.00    52.00    51.00    63.00    61.00
 50.00      .00  3.00     2.00     1.00     1.00    50.00    59.00    42.00    53.00    61.00
 11.00      .00  1.00     2.00     1.00     2.00    34.00    46.00    45.00    39.00    36.00
 84.00      .00  4.00     2.00     1.00     1.00    63.00    57.00    54.00    58.00    51.00
 48.00      .00  3.00     2.00     1.00     2.00    57.00    55.00    52.00    50.00    51.00
 75.00      .00  4.00     2.00     1.00     3.00    60.00    46.00    51.00    53.00    61.00
 60.00      .00  4.00     2.00     1.00     2.00    57.00    65.00    51.00    63.00    61.00
 95.00      .00  4.00     3.00     1.00     2.00    73.00    60.00    71.00    61.00    71.00
104.00      .00  4.00     3.00     1.00     2.00    54.00    63.00    57.00    55.00    46.00
 38.00      .00  3.00     1.00     1.00     2.00    45.00    57.00    50.00    31.00    56.00
115.00      .00  4.00     1.00     1.00     1.00    42.00    49.00    43.00    50.00    56.00
 76.00      .00  4.00     3.00     1.00     2.00    47.00    52.00    51.00    50.00    56.00
195.00      .00  4.00     2.00     2.00     1.00    57.00    57.00    60.00    58.00    56.00
114.00      .00  4.00     3.00     1.00     2.00    68.00    65.00    62.00    55.00    61.00
 85.00      .00  4.00     2.00     1.00     1.00    55.00    39.00    57.00    53.00    46.00
167.00      .00  4.00     2.00     1.00     1.00    63.00    49.00    35.00    66.00    41.00
143.00      .00  4.00     2.00     1.00     3.00    63.00    63.00    75.00    72.00    66.00
 41.00      .00  3.00     2.00     1.00     2.00    50.00    40.00    45.00    55.00    56.00
 20.00      .00  1.00     3.00     1.00     2.00    60.00    52.00    57.00    61.00    61.00
 12.00      .00  1.00     2.00     1.00     3.00    37.00    44.00    45.00    39.00    46.00
 53.00      .00  3.00     2.00     1.00     3.00    34.00    37.00    46.00    39.00    31.00
154.00      .00  4.00     3.00     1.00     2.00    65.00    65.00    66.00    61.00    66.00
178.00      .00  4.00     2.00     2.00     3.00    47.00    57.00    57.00    58.00    46.00
196.00      .00  4.00     3.00     2.00     2.00    44.00    38.00    49.00    39.00    46.00
 29.00      .00  2.00     1.00     1.00     1.00    52.00    44.00    49.00    55.00    41.00
126.00      .00  4.00     2.00     1.00     1.00    42.00    31.00    57.00    47.00    51.00
103.00      .00  4.00     3.00     1.00     2.00    76.00    52.00    64.00    64.00    61.00
192.00      .00  4.00     3.00     2.00     2.00    65.00    67.00    63.00    66.00    71.00
150.00      .00  4.00     2.00     1.00     3.00    42.00    41.00    57.00    72.00    31.00
199.00      .00  4.00     3.00     2.00     2.00    52.00    59.00    50.00    61.00    61.00
144.00      .00  4.00     3.00     1.00     1.00    60.00    65.00    58.00    61.00    66.00
200.00      .00  4.00     2.00     2.00     2.00    68.00    54.00    75.00    66.00    66.00
 80.00      .00  4.00     3.00     1.00     2.00    65.00    62.00    68.00    66.00    66.00
 16.00      .00  1.00     1.00     1.00     3.00    47.00    31.00    44.00    36.00    36.00
153.00      .00  4.00     2.00     1.00     3.00    39.00    31.00    40.00    39.00    51.00
176.00      .00  4.00     2.00     2.00     2.00    47.00    47.00    41.00    42.00    51.00
177.00      .00  4.00     2.00     2.00     2.00    55.00    59.00    62.00    58.00    51.00
168.00      .00  4.00     2.00     1.00     2.00    52.00    54.00    57.00    55.00    51.00
 40.00      .00  3.00     1.00     1.00     1.00    42.00    41.00    43.00    50.00    41.00
 62.00      .00  4.00     3.00     1.00     1.00    65.00    65.00    48.00    63.00    66.00
169.00      .00  4.00     1.00     1.00     1.00    55.00    59.00    63.00    69.00    46.00
 49.00      .00  3.00     3.00     1.00     3.00    50.00    40.00    39.00    49.00    47.00
136.00      .00  4.00     2.00     1.00     2.00    65.00    59.00    70.00    63.00    51.00
189.00      .00  4.00     2.00     2.00     2.00    47.00    59.00    63.00    53.00    46.00
  7.00      .00  1.00     2.00     1.00     2.00    57.00    54.00    59.00    47.00    51.00
 27.00      .00  2.00     2.00     1.00     2.00    53.00    61.00    61.00    57.00    56.00
128.00      .00  4.00     3.00     1.00     2.00    39.00    33.00    38.00    47.00    41.00
 21.00      .00  1.00     2.00     1.00     1.00    44.00    44.00    61.00    50.00    46.00
183.00      .00  4.00     2.00     2.00     2.00    63.00    59.00    49.00    55.00    71.00
132.00      .00  4.00     2.00     1.00     2.00    73.00    62.00    73.00    69.00    66.00
 15.00      .00  1.00     3.00     1.00     3.00    39.00    39.00    44.00    26.00    42.00
 67.00      .00  4.00     1.00     1.00     3.00    37.00    37.00    42.00    33.00    32.00
 22.00      .00  1.00     2.00     1.00     3.00    42.00    39.00    39.00    56.00    46.00
185.00      .00  4.00     2.00     2.00     2.00    63.00    57.00    55.00    58.00    41.00
  9.00      .00  1.00     2.00     1.00     3.00    48.00    49.00    52.00    44.00    51.00
181.00      .00  4.00     2.00     2.00     2.00    50.00    46.00    45.00    58.00    61.00
170.00      .00  4.00     3.00     1.00     2.00    47.00    62.00    61.00    69.00    66.00
134.00      .00  4.00     1.00     1.00     1.00    44.00    44.00    39.00    34.00    46.00
108.00      .00  4.00     2.00     1.00     1.00    34.00    33.00    41.00    36.00    36.00
197.00      .00  4.00     3.00     2.00     2.00    50.00    42.00    50.00    36.00    61.00
140.00      .00  4.00     2.00     1.00     3.00    44.00    41.00    40.00    50.00    26.00
171.00      .00  4.00     2.00     1.00     2.00    60.00    54.00    60.00    55.00    66.00
107.00      .00  4.00     1.00     1.00     3.00    47.00    39.00    47.00    42.00    26.00
 81.00      .00  4.00     1.00     1.00     2.00    63.00    43.00    59.00    65.00    44.00
 18.00      .00  1.00     2.00     1.00     3.00    50.00    33.00    49.00    44.00    36.00
155.00      .00  4.00     2.00     1.00     1.00    44.00    44.00    46.00    39.00    51.00
 97.00      .00  4.00     3.00     1.00     2.00    60.00    54.00    58.00    58.00    61.00
 68.00      .00  4.00     2.00     1.00     2.00    73.00    67.00    71.00    63.00    66.00
157.00      .00  4.00     2.00     1.00     1.00    68.00    59.00    58.00    74.00    66.00
 56.00      .00  4.00     2.00     1.00     3.00    55.00    45.00    46.00    58.00    51.00
  5.00      .00  1.00     1.00     1.00     2.00    47.00    40.00    43.00    45.00    31.00
159.00      .00  4.00     3.00     1.00     2.00    55.00    61.00    54.00    49.00    61.00
123.00      .00  4.00     3.00     1.00     1.00    68.00    59.00    56.00    63.00    66.00
164.00      .00  4.00     2.00     1.00     3.00    31.00    36.00    46.00    39.00    46.00
 14.00      .00  1.00     3.00     1.00     2.00    47.00    41.00    54.00    42.00    56.00
127.00      .00  4.00     3.00     1.00     2.00    63.00    59.00    57.00    55.00    56.00
165.00      .00  4.00     1.00     1.00     3.00    36.00    49.00    54.00    61.00    36.00
174.00      .00  4.00     2.00     2.00     2.00    68.00    59.00    71.00    66.00    56.00
  3.00      .00  1.00     1.00     1.00     2.00    63.00    65.00    48.00    63.00    56.00
 58.00      .00  4.00     2.00     1.00     3.00    55.00    41.00    40.00    44.00    41.00
146.00      .00  4.00     3.00     1.00     2.00    55.00    62.00    64.00    63.00    66.00
102.00      .00  4.00     3.00     1.00     2.00    52.00    41.00    51.00    53.00    56.00
117.00      .00  4.00     3.00     1.00     3.00    34.00    49.00    39.00    42.00    56.00
133.00      .00  4.00     2.00     1.00     3.00    50.00    31.00    40.00    34.00    31.00
 94.00      .00  4.00     3.00     1.00     2.00    55.00    49.00    61.00    61.00    56.00
 24.00      .00  2.00     2.00     1.00     2.00    52.00    62.00    66.00    47.00    46.00
149.00      .00  4.00     1.00     1.00     1.00    63.00    49.00    49.00    66.00    46.00
 82.00     1.00  4.00     3.00     1.00     2.00    68.00    62.00    65.00    69.00    61.00
  8.00     1.00  1.00     1.00     1.00     2.00    39.00    44.00    52.00    44.00    48.00
129.00     1.00  4.00     1.00     1.00     1.00    44.00    44.00    46.00    47.00    51.00
173.00     1.00  4.00     1.00     1.00     1.00    50.00    62.00    61.00    63.00    51.00
 57.00     1.00  4.00     2.00     1.00     2.00    71.00    65.00    72.00    66.00    56.00
100.00     1.00  4.00     3.00     1.00     2.00    63.00    65.00    71.00    69.00    71.00
  1.00     1.00  1.00     1.00     1.00     3.00    34.00    44.00    40.00    39.00    41.00
194.00     1.00  4.00     3.00     2.00     2.00    63.00    63.00    69.00    61.00    61.00
 88.00     1.00  4.00     3.00     1.00     2.00    68.00    60.00    64.00    69.00    66.00
 99.00     1.00  4.00     3.00     1.00     1.00    47.00    59.00    56.00    66.00    61.00
 47.00     1.00  3.00     1.00     1.00     2.00    47.00    46.00    49.00    33.00    41.00
120.00     1.00  4.00     3.00     1.00     2.00    63.00    52.00    54.00    50.00    51.00
166.00     1.00  4.00     2.00     1.00     2.00    52.00    59.00    53.00    61.00    51.00
 65.00     1.00  4.00     2.00     1.00     2.00    55.00    54.00    66.00    42.00    56.00
101.00     1.00  4.00     3.00     1.00     2.00    60.00    62.00    67.00    50.00    56.00
 89.00     1.00  4.00     1.00     1.00     3.00    35.00    35.00    40.00    51.00    33.00
 54.00     1.00  3.00     1.00     2.00     1.00    47.00    54.00    46.00    50.00    56.00
180.00     1.00  4.00     3.00     2.00     2.00    71.00    65.00    69.00    58.00    71.00
162.00     1.00  4.00     2.00     1.00     3.00    57.00    52.00    40.00    61.00    56.00
  4.00     1.00  1.00     1.00     1.00     2.00    44.00    50.00    41.00    39.00    51.00
131.00     1.00  4.00     3.00     1.00     2.00    65.00    59.00    57.00    46.00    66.00
125.00     1.00  4.00     1.00     1.00     2.00    68.00    65.00    58.00    59.00    56.00
 34.00     1.00  1.00     3.00     2.00     2.00    73.00    61.00    57.00    55.00    66.00
106.00     1.00  4.00     2.00     1.00     3.00    36.00    44.00    37.00    42.00    41.00
130.00     1.00  4.00     3.00     1.00     1.00    43.00    54.00    55.00    55.00    46.00
 93.00     1.00  4.00     3.00     1.00     2.00    73.00    67.00    62.00    58.00    66.00
163.00     1.00  4.00     1.00     1.00     2.00    52.00    57.00    64.00    58.00    56.00
 37.00     1.00  3.00     1.00     1.00     3.00    41.00    47.00    40.00    39.00    51.00
 35.00     1.00  1.00     1.00     2.00     1.00    60.00    54.00    50.00    50.00    51.00
 87.00     1.00  4.00     2.00     1.00     1.00    50.00    52.00    46.00    50.00    56.00
 73.00     1.00  4.00     2.00     1.00     2.00    50.00    52.00    53.00    39.00    56.00
151.00     1.00  4.00     2.00     1.00     3.00    47.00    46.00    52.00    48.00    46.00
 44.00     1.00  3.00     1.00     1.00     3.00    47.00    62.00    45.00    34.00    46.00
152.00     1.00  4.00     3.00     1.00     2.00    55.00    57.00    56.00    58.00    61.00
105.00     1.00  4.00     2.00     1.00     2.00    50.00    41.00    45.00    44.00    56.00
 28.00     1.00  2.00     2.00     1.00     1.00    39.00    53.00    54.00    50.00    41.00
 91.00     1.00  4.00     3.00     1.00     3.00    50.00    49.00    56.00    47.00    46.00
 45.00     1.00  3.00     1.00     1.00     3.00    34.00    35.00    41.00    29.00    26.00
116.00     1.00  4.00     2.00     1.00     2.00    57.00    59.00    54.00    50.00    56.00
 33.00     1.00  2.00     1.00     1.00     2.00    57.00    65.00    72.00    54.00    56.00
 66.00     1.00  4.00     2.00     1.00     3.00    68.00    62.00    56.00    50.00    51.00
 72.00     1.00  4.00     2.00     1.00     3.00    42.00    54.00    47.00    47.00    46.00
 77.00     1.00  4.00     1.00     1.00     2.00    61.00    59.00    49.00    44.00    66.00
 61.00     1.00  4.00     3.00     1.00     2.00    76.00    63.00    60.00    67.00    66.00
190.00     1.00  4.00     2.00     2.00     2.00    47.00    59.00    54.00    58.00    46.00
 42.00     1.00  3.00     2.00     1.00     3.00    46.00    52.00    55.00    44.00    56.00
  2.00     1.00  1.00     2.00     1.00     3.00    39.00    41.00    33.00    42.00    41.00
 55.00     1.00  3.00     2.00     2.00     2.00    52.00    49.00    49.00    44.00    61.00
 19.00     1.00  1.00     1.00     1.00     1.00    28.00    46.00    43.00    44.00    51.00
 90.00     1.00  4.00     3.00     1.00     2.00    42.00    54.00    50.00    50.00    52.00
142.00     1.00  4.00     2.00     1.00     3.00    47.00    42.00    52.00    39.00    51.00
 17.00     1.00  1.00     2.00     1.00     2.00    47.00    57.00    48.00    44.00    41.00
122.00     1.00  4.00     2.00     1.00     2.00    52.00    59.00    58.00    53.00    66.00
191.00     1.00  4.00     3.00     2.00     2.00    47.00    52.00    43.00    48.00    61.00
 83.00     1.00  4.00     2.00     1.00     3.00    50.00    62.00    41.00    55.00    31.00
182.00     1.00  4.00     2.00     2.00     2.00    44.00    52.00    43.00    44.00    51.00
  6.00     1.00  1.00     1.00     1.00     2.00    47.00    41.00    46.00    40.00    41.00
 46.00     1.00  3.00     1.00     1.00     2.00    45.00    55.00    44.00    34.00    41.00
 43.00     1.00  3.00     1.00     1.00     2.00    47.00    37.00    43.00    42.00    46.00
 96.00     1.00  4.00     3.00     1.00     2.00    65.00    54.00    61.00    58.00    56.00
138.00     1.00  4.00     2.00     1.00     3.00    43.00    57.00    40.00    50.00    51.00
 10.00     1.00  1.00     2.00     1.00     1.00    47.00    54.00    49.00    53.00    61.00
 71.00     1.00  4.00     2.00     1.00     1.00    57.00    62.00    56.00    58.00    66.00
139.00     1.00  4.00     2.00     1.00     2.00    68.00    59.00    61.00    55.00    71.00
110.00     1.00  4.00     2.00     1.00     3.00    52.00    55.00    50.00    54.00    61.00
148.00     1.00  4.00     2.00     1.00     3.00    42.00    57.00    51.00    47.00    61.00
109.00     1.00  4.00     2.00     1.00     1.00    42.00    39.00    42.00    42.00    41.00
 39.00     1.00  3.00     3.00     1.00     2.00    66.00    67.00    67.00    61.00    66.00
147.00     1.00  4.00     1.00     1.00     2.00    47.00    62.00    53.00    53.00    61.00
 74.00     1.00  4.00     2.00     1.00     2.00    57.00    50.00    50.00    51.00    58.00
198.00     1.00  4.00     3.00     2.00     2.00    47.00    61.00    51.00    63.00    31.00
161.00     1.00  4.00     1.00     1.00     2.00    57.00    62.00    72.00    61.00    61.00
112.00     1.00  4.00     2.00     1.00     2.00    52.00    59.00    48.00    55.00    61.00
 69.00     1.00  4.00     1.00     1.00     3.00    44.00    44.00    40.00    40.00    31.00
156.00     1.00  4.00     2.00     1.00     2.00    50.00    59.00    53.00    61.00    61.00
111.00     1.00  4.00     1.00     1.00     1.00    39.00    54.00    39.00    47.00    36.00
186.00     1.00  4.00     2.00     2.00     2.00    57.00    62.00    63.00    55.00    41.00
 98.00     1.00  4.00     1.00     1.00     3.00    57.00    60.00    51.00    53.00    37.00
119.00     1.00  4.00     1.00     1.00     1.00    42.00    57.00    45.00    50.00    43.00
 13.00     1.00  1.00     2.00     1.00     3.00    47.00    46.00    39.00    47.00    61.00
 51.00     1.00  3.00     3.00     1.00     1.00    42.00    36.00    42.00    31.00    39.00
 26.00     1.00  2.00     3.00     1.00     2.00    60.00    59.00    62.00    61.00    51.00
 36.00     1.00  3.00     1.00     1.00     1.00    44.00    49.00    44.00    35.00    51.00
135.00     1.00  4.00     1.00     1.00     2.00    63.00    60.00    65.00    54.00    66.00
 59.00     1.00  4.00     2.00     1.00     2.00    65.00    67.00    63.00    55.00    71.00
 78.00     1.00  4.00     2.00     1.00     2.00    39.00    54.00    54.00    53.00    41.00
 64.00     1.00  4.00     3.00     1.00     3.00    50.00    52.00    45.00    58.00    36.00
 63.00     1.00  4.00     1.00     1.00     1.00    52.00    65.00    60.00    56.00    51.00
 79.00     1.00  4.00     2.00     1.00     2.00    60.00    62.00    49.00    50.00    51.00
193.00     1.00  4.00     2.00     2.00     2.00    44.00    49.00    48.00    39.00    51.00
 92.00     1.00  4.00     3.00     1.00     1.00    52.00    67.00    57.00    63.00    61.00
160.00     1.00  4.00     2.00     1.00     2.00    55.00    65.00    55.00    50.00    61.00
 32.00     1.00  2.00     3.00     1.00     3.00    50.00    67.00    66.00    66.00    56.00
 23.00     1.00  2.00     1.00     1.00     2.00    65.00    65.00    64.00    58.00    71.00
158.00     1.00  4.00     2.00     1.00     1.00    52.00    54.00    55.00    53.00    51.00
 25.00     1.00  2.00     2.00     1.00     1.00    47.00    44.00    42.00    42.00    36.00
188.00     1.00  4.00     3.00     2.00     2.00    63.00    62.00    56.00    55.00    61.00
 52.00     1.00  3.00     1.00     1.00     2.00    50.00    46.00    53.00    53.00    66.00
124.00     1.00  4.00     1.00     1.00     3.00    42.00    54.00    41.00    42.00    41.00
175.00     1.00  4.00     3.00     2.00     1.00    36.00    57.00    42.00    50.00    41.00
184.00     1.00  4.00     2.00     2.00     3.00    50.00    52.00    53.00    55.00    56.00
 30.00     1.00  2.00     3.00     1.00     2.00    41.00    59.00    42.00    34.00    51.00
179.00     1.00  4.00     2.00     2.00     2.00    47.00    65.00    60.00    50.00    56.00
 31.00     1.00  2.00     2.00     2.00     1.00    55.00    59.00    52.00    42.00    56.00
145.00     1.00  4.00     2.00     1.00     3.00    42.00    46.00    38.00    36.00    46.00
187.00     1.00  4.00     2.00     2.00     1.00    57.00    41.00    57.00    55.00    52.00
118.00     1.00  4.00     2.00     1.00     1.00    55.00    62.00    58.00    58.00    61.00
137.00     1.00  4.00     3.00     1.00     2.00    63.00    65.00    65.00    53.00    61.00
end data.

factor
  /variables read write math science socst
  /analysis read write math science socst
  /extraction pc
  /plot eigen
  /criteria mineigen (.557)
  .
])

AT_CHECK([pspp -O format=csv factor2.sps], [0],
  [Table: Communalities
,Initial,Extraction
read,1.000,.736
write,1.000,.704
math,1.000,.750
science,1.000,.849
socst,1.000,.900

Table: Total Variance Explained
,Initial Eigenvalues,,,Extraction Sums of Squared Loadings,,,Rotation Sums of Squared Loadings,,
,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %
1,3.381,67.6%,67.6%,3.381,67.6%,67.6%,2.113,42.3%,42.3%
2,.557,11.1%,78.8%,.557,11.1%,78.8%,1.825,36.5%,78.8%
3,.407,8.1%,86.9%,,,,,,
4,.356,7.1%,94.0%,,,,,,
5,.299,6.0%,100.0%,,,,,,

Table: Component Matrix
,Component,
,1,2
read,.858,.020
write,.824,-.155
math,.844,.195
science,.801,.456
socst,.783,-.536

Table: Rotated Component Matrix
,Component,
,1,2
read,.650,.559
write,.508,.667
math,.757,.421
science,.900,.198
socst,.222,.922
])

AT_CLEANUP



AT_SETUP([FACTOR empty dataset])
dnl Test that something sane happens when the dataset contains no complete observations

AT_DATA([factor-empty.sps],
  [data list notable list /x * y * z *.
begin data.
3.4        .     92.9
.        32.09   34.2
1.00     19.80     .
2.00       .      3.6
end data.

factor /variables = ALL.
])

AT_CHECK([pspp -O format=csv factor-empty.sps], [0], [ignore])
AT_CLEANUP


dnl Fixes a crash reported at
dnl http://lists.gnu.org/archive/html/bug-gnu-pspp/2012-04/msg00001.html
AT_SETUP([FACTOR /ROTATION=NOROTATE])
AT_DATA([factor-norotate.sps], [dnl
DATA LIST FREE / TRAIT1 TO TRAIT5 (F8.2).
BEGIN DATA
1 5 5 1 1
8 9 7 9 8
9 8 9 9 8
9 9 9 9 9
1 9 1 1 9
9 7 7 9 9
9 7 9 9 7
END DATA

SET SMALL=0.
FACTOR /VARIABLES=TRAIT1 TO TRAIT5
    /ROTATION=NOROTATE /* NOROTATE may have caused the problem. */
    /EXTRACTION=PC
    /PRINT=DEFAULT DET UNIVARIATE ROTATION SIG CORRELATION.
])

AT_CHECK([pspp -O format=csv factor-norotate.sps], [0], [dnl
Table: Descriptive Statistics
,Mean,Std. Deviation,Analysis N
TRAIT1,6.57,3.54,7
TRAIT2,7.71,1.39,7
TRAIT3,6.71,2.71,7
TRAIT4,6.71,3.61,7
TRAIT5,7.29,2.66,7

Table: Correlation Matrix
,,TRAIT1,TRAIT2,TRAIT3,TRAIT4,TRAIT5
Correlation,TRAIT1,1.000,.296,.881,.995,.545
,TRAIT2,.296,1.000,-.022,.326,.837
,TRAIT3,.881,-.022,1.000,.867,.130
,TRAIT4,.995,.326,.867,1.000,.544
,TRAIT5,.545,.837,.130,.544,1.000
Sig. (1-tailed),TRAIT1,,.260,.004,.000,.103
,TRAIT2,.260,,.482,.238,.009
,TRAIT3,.004,.482,,.006,.390
,TRAIT4,.000,.238,.006,,.103
,TRAIT5,.103,.009,.390,.103,
Caption: Determinant: 0.00

Table: Communalities
,Initial,Extraction
TRAIT1,1.00,1.00
TRAIT2,1.00,1.00
TRAIT3,1.00,.99
TRAIT4,1.00,.99
TRAIT5,1.00,.99

Table: Total Variance Explained
,Initial Eigenvalues,,,Extraction Sums of Squared Loadings,,
,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %
1,3.26,65.3%,65.3%,3.26,65.3%,65.3%
2,1.54,30.8%,96.0%,1.54,30.8%,96.0%
3,.17,3.4%,99.4%,.17,3.4%,99.4%
4,.03,.6%,100.0%,.03,.6%,100.0%
5,.00,.0%,100.0%,,,

Table: Component Matrix
,Component,,,
,1,2,3,4
TRAIT1,.97,.23,-.08,.00
TRAIT2,.52,-.81,.28,.00
TRAIT3,.78,.59,.17,.00
TRAIT4,.97,.21,-.04,.00
TRAIT5,.70,-.67,-.23,.00
])
AT_CLEANUP



dnl Fixes a bug in the way that the /CRITERIA = ITERATE option was interpreted.
dnl http://lists.gnu.org/archive/html/bug-gnu-pspp/2013-09/msg00036.html
AT_SETUP([FACTOR /CRITERIA=ITERATE])
AT_DATA([factor-iterate.sps], [dnl
set format = F20.3.
data list notable list /x y z *.
begin data.
1.00    5.00    3.00
2.00    2.00    2.00
3.00    1.00    1.00
4.00    4.00    5.00
5.00    3.00    9.00
6.00    6.00    4.00
7.00    7.00    6.00
8.00    8.00    8.00
9.00    9.00    7.00
end data.

FACTOR
 /VARIABLES= x y z
 /CRITERIA = MINEIGEN (1) ITERATE (25)
 /EXTRACTION =PAF
 /METHOD = CORRELATION
 /PRINT = INITIAL EXTRACTION
 /CRITERIA = ITERATE (0)
 /ROTATION = NOROTATE.
])

AT_CHECK([pspp -O format=csv factor-iterate.sps], [0], [dnl
Table: Communalities
,Initial,Extraction
x,.735,.979
y,.640,.653
z,.514,.523

Table: Total Variance Explained
,Initial Eigenvalues,,,Extraction Sums of Squared Loadings,,
,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %
1,2.404,80.1%,80.1%,2.155,71.8%,71.8%
2,.425,14.2%,94.3%,,,
3,.171,5.7%,100.0%,,,

Table: Factor Matrix
,Factor
,1
x,.990
y,.808
z,.723
])
AT_CLEANUP


AT_SETUP([FACTOR promax])
AT_DATA([factor-promax.sps], [dnl
set decimal=dot.
set format=F22.3.

get file='llz.zsav'.

factor
	/variables pz pn ps nz nn ns tz tn ts oz on os sz sn ss zz zn zs
	/missing listwise
	/print initial extraction rotation
	/criteria mineigen(1) iterate(25)
	/extraction paf
	/method correlation
	/rotation promax (5).
])

AT_CHECK([ln -s $top_srcdir/tests/language/stats/llz.zsav .], [0], [ignore])

AT_CHECK([pspp -O format=csv factor-promax.sps], [0], [dnl
Table: Communalities
,Initial,Extraction
PZ,.191,.375
PN,.042,.102
PS,.458,.623
NZ,.100,.163
NN,.065,.079
NS,.129,.148
TZ,.181,.344
TN,.102,.142
TS,.310,.372
OZ,.097,.158
ON,.323,.410
OS,.469,.617
SZ,.104,.170
SN,.154,.267
SS,.081,.180
ZZ,.123,.192
ZN,.208,.412
ZS,.130,.158

Table: Total Variance Explained
,Initial Eigenvalues,,,Extraction Sums of Squared Loadings,,,Rotation Sums of Squared Loadings,,
,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %
1,2.968,16.5%,16.5%,2.411,13.4%,13.4%,.   ,.  ,.  @&t@
2,2.026,11.3%,27.7%,1.271,7.1%,20.5%,.   ,.  ,-Infinity
3,1.622,9.0%,36.8%,.948,5.3%,25.7%,.   ,.  ,-Infinity
4,1.086,6.0%,42.8%,.283,1.6%,27.3%,.   ,.  ,-Infinity
5,.996,5.5%,48.3%,,,,,,
6,.923,5.1%,53.5%,,,,,,
7,.873,4.9%,58.3%,,,,,,
8,.856,4.8%,63.1%,,,,,,
9,.836,4.6%,67.7%,,,,,,
10,.816,4.5%,72.2%,,,,,,
11,.785,4.4%,76.6%,,,,,,
12,.740,4.1%,80.7%,,,,,,
13,.713,4.0%,84.7%,,,,,,
14,.653,3.6%,88.3%,,,,,,
15,.633,3.5%,91.8%,,,,,,
16,.604,3.4%,95.2%,,,,,,
17,.484,2.7%,97.9%,,,,,,
18,.386,2.1%,100.0%,,,,,,

Table: Factor Matrix
,Factor,,,
,1,2,3,4
PZ,-.276,.154,.510,.124
PN,.096,.129,-.091,.261
PS,.746,-.085,.234,.063
NZ,-.111,.323,.206,-.058
NN,.007,.260,-.083,-.069
NS,.366,.096,.046,.051
TZ,-.228,.172,.509,.059
TN,.131,.345,-.074,.029
TS,.601,-.005,.098,.030
OZ,-.145,.166,.322,-.081
ON,.607,.082,.073,-.173
OS,.757,-.059,.171,-.104
SZ,-.142,.307,.226,-.066
SN,.175,.436,-.183,.115
SS,.199,.206,-.083,.302
ZZ,-.074,.411,-.080,-.104
ZN,.015,.580,-.252,-.114
ZS,.365,.156,-.004,.015

Table: Pattern Matrix
,Factor,,,
,1,2,3,4
PZ,-.063,-.126,.599,.085
PN,-.035,.000,-.033,.325
PS,.762,-.175,.058,.081
NZ,.027,.230,.327,-.044
NN,.008,.289,.008,-.026
NS,.344,.044,.015,.091
TZ,.004,-.074,.589,.020
TN,.097,.307,.033,.103
TS,.585,-.043,-.017,.062
OZ,.046,.067,.382,-.109
ON,.654,.151,-.029,-.145
OS,.803,-.037,-.009,-.092
SZ,.009,.213,.345,-.060
SN,.065,.376,-.036,.227
SS,.054,.042,-.013,.388
ZZ,-.044,.434,.078,-.046
ZN,-.025,.646,-.041,-.006
ZS,.337,.133,-.013,.067

Table: Structure Matrix
,Factor,,,
,1,2,3,4
PZ,-.177,-.058,.598,-.022
PN,.068,.110,-.049,.317
PS,.771,-.138,-.136,.240
NZ,-.060,.236,.339,.019
NN,.000,.281,.027,.076
NS,.368,.080,-.068,.207
TZ,-.127,-.028,.582,-.049
TN,.122,.345,.023,.235
TS,.607,-.018,-.160,.221
OZ,-.074,.055,.384,-.101
ON,.619,.104,-.160,.102
OS,.778,-.064,-.190,.132
SZ,-.086,.215,.361,-.009
SN,.143,.453,-.044,.380
SS,.171,.176,-.052,.420
ZZ,-.073,.422,.120,.085
ZN,-.013,.641,.008,.214
ZS,.361,.158,-.088,.213

Table: Factor Correlation Matrix
Factor,1,2,3,4
1,1.000,.008,-.232,.294
2,.008,1.000,.065,.347
3,-.232,.065,1.000,-.076
4,.294,.347,-.076,1.000
])


AT_CLEANUP






AT_SETUP([FACTOR covariance matrix])

AT_DATA([covariance-matrix.sps], [dnl
set format = F10.3.
matrix data
    variables = rowtype_  var01 var02 var03 var04 var05 var06 var07 var08
    / format = lower diagonal .
begin data
mean     24.3  5.4  69.7  20.1  13.4  2.7  27.9  3.7
sd        5.7  1.5  23.5  5.8    2.8  4.5   5.4  1.5
n        92   92    92   92     92   92    92   92
cov   32.490000
cov   1.539000 2.250000
cov   -29.469000 -5.992500 552.250000
cov   11.901600 2.697000 -19.082000 33.640000
cov   4.309200 0.672000 -7.896000 3.572800 7.840000
cov   8.464500 1.012500 -17.977500 6.264000 2.646000 20.250000
cov   15.390000 2.349000 -25.380000 10.022400 1.814400 9.234000 29.160000
cov   1.453500 0.652500 -1.762500 1.740000 1.134000 1.350000 0.324000 2.250000
end data.

factor matrix in (cov = *)
    / method = covariance
    / print = initial covariance
    / extraction = pc
    / rotation = norotate.
])

AT_CHECK([pspp -O format=csv covariance-matrix.sps], [0], [dnl
Table: Covariance Matrix
,var01,var02,var03,var04,var05,var06,var07,var08
var01,32.490,1.539,-29.469,11.902,4.309,8.464,15.390,1.454
var02,1.539,2.250,-5.992,2.697,.672,1.013,2.349,.653
var03,-29.469,-5.992,552.250,-19.082,-7.896,-17.977,-25.380,-1.763
var04,11.902,2.697,-19.082,33.640,3.573,6.264,10.022,1.740
var05,4.309,.672,-7.896,3.573,7.840,2.646,1.814,1.134
var06,8.464,1.013,-17.977,6.264,2.646,20.250,9.234,1.350
var07,15.390,2.349,-25.380,10.022,1.814,9.234,29.160,.324
var08,1.454,.653,-1.763,1.740,1.134,1.350,.324,2.250

Table: Communalities
,Initial
var01,32.490
var02,2.250
var03,552.250
var04,33.640
var05,7.840
var06,20.250
var07,29.160
var08,2.250

Table: Total Variance Explained
,Initial Eigenvalues,,
,Total,% of Variance,Cumulative %
1,556.895,81.9%,81.9%
2,57.963,8.5%,90.4%
3,23.576,3.5%,93.9%
4,16.446,2.4%,96.3%
5,14.603,2.1%,98.4%
6,6.831,1.0%,99.4%
7,2.375,.3%,99.8%
8,1.440,.2%,100.0%

Table: Component Matrix
,Component,,,,,,
,1,2,3,4,5,6,7
var01,1.394,4.388,1.513,-2.851,.849,.396,.033
var02,.269,.460,-.173,.147,-.146,-.213,.872
var03,-23.489,.725,.058,.003,.022,-.012,.006
var04,.926,4.007,-4.068,.241,-.253,.218,-.026
var05,.363,.829,-.172,-.255,.805,-2.492,.058
var06,.843,2.354,.971,2.425,2.649,.392,.046
var07,1.205,3.948,1.926,1.515,-2.450,-.317,-.087
var08,.085,.319,-.157,-.011,.353,-.341,-.816
])

AT_CLEANUP



dnl A more realistic example of factor analysis usage.
AT_SETUP([FACTOR correlation matrix])

AT_DATA([correlation-matrix.sps], [dnl
set format = F10.3.

matrix data
    variables = rowtype_
    cdi_actws_16  cdi_maxzin_16  rdls_passws_16  rdls_actws_16  cdi_actws_20  cdi_maxzin_20  cdi_actws_26  cdi_maxzin_26  rdls_passws_26  rdls_actws_26
    nepsy_passws_36  morf_verv_36  bnt_actws_36  klankgr_id_36  snelnoe_36  letters_36  ppvt_passws_50  morf_verv_50
    nepsy_passws_56  bnt_actws_56  klank_gr_weg_56  snelnoe_56  letters_56
    leesacc_wo_owo_811  leesacc_tekst_811  leesacc_otekst_811  leessne_wo_owo_811  leesvl_tekst_811  leesvl_otekst_811  leessne_wo_811  spel_wo_owo_811
    / format = upper diagonal .
begin data
mean  64.44  1.74  15.30  11.50  269.03  5.37  441.90  8.57  36.59  33.99  11.68  14.74  18.67  6.70  71.57  2.28  70.45  51.82  18.82  34.57  11.68  45.63  12.94  35.08  92.60  79.28  2.78  61.71  29.44  9.46  13.17
sd   74.93  1.36  5.51  4.17  159.26  2.76  128.77  3.50  6.20  6.50  3.55  8.37  5.90  3.01  24.81  4.09  24.44  18.55  2.90  6.46  3.01  14.06  7.69  4.36  7.10  17.57  1.27  25.68  11.75  3.36  4.13
n     150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150 150
corr    1.00  .784  .397  .862  .692  .625  .490  .374  .406  .371  .260  .257  .306  .118  -.148  .072  .202  .234  .198  .241  .205  -.054  .246  .166  .143  .155  -.122  .144  -.010  .135  .241
corr    1.00  .333  .751  .549  .553  .447  .313  .304  .377  .204  .249  .258  .193  -.158  .119  .150  .216  .127  .209  .242  .046  .233  .120  .155  .107  -.126  .147  -.009  .134  .208
corr    1.00  .469  .433  .381  .442  .307  .462  .391  .378  .293  .369  .191  -.306  .238  .204  .215  .295  .285  .157  .069  .241  .029  .060  .054  -.043  .124  -.069  .054  .136
corr    1.00  .708  .663  .509  .419  .434  .432  .267  .255  .342  .132  -.192  .142  .228  .203  .248  .260  .200  -.051  .254  .136  .156  .109  -.126  .172  -.004  .157  .268
corr    1.00  .787  .710  .567  .402  .511  .274  .285  .332  .154  -.096  .247  .253  .235  .245  .257  .261  -.048  .243  .119  .194  .164  -.108  .184  .011  .157  .235
corr    1.00  .590  .646  .449  .505  .313  .322  .405  .148  -.117  .152  .294  .322  .252  .321  .267  -.055  .255  .118  .178  .137  -.110  .182  .004  .146  .216
corr    1.00  .548  .343  .619  .296  .260  .456  .149  -.098  .252  .279  .267  .342  .361  .186  -.066  .215  .107  .148  .059  -.114  .156  -.035  .095  .220
corr    1.00  .406  .509  .397  .236  .416  .037  -.179  .192  .334  .293  .277  .367  .162  -.150  .306  .171  .307  .173  -.128  .255  .075  .224  .315
corr    1.00  .410  .497  .560  .574  .240  -.301  .204  .508  .351  .457  .428  .242  -.117  .367  .136  .191  .191  -.102  .215  .053  .185  .273
corr    1.00  .328  .258  .534  .236  -.202  .200  .333  .209  .352  .375  .302  -.119  .272  .062  .203  .042  -.092  .220  .020  .158  .227
corr    1.00  .439  .488  .323  -.213  .287  .507  .427  .493  .522  .298  -.142  .371  .109  .215  .213  -.048  .228  .009  .133  .267
corr    1.00  .437  .381  -.158  .153  .403  .430  .383  .379  .150  -.141  .303  .115  .131  .155  -.170  .206  .039  .193  .254
corr    1.00  .247  -.143  .182  .521  .364  .415  .688  .304  -.185  .327  .188  .211  .202  -.111  .272  .122  .226  .301
corr    1.00  -.150  .229  .296  .249  .329  .255  .210  -.036  .252  .141  .230  .112  -.195  .309  .135  .250  .195
corr    1.00  -.132  -.204  -.162  -.284  -.166  -.189  .294  -.339  -.094  -.218  -.144  .153  -.246  -.128  -.192  -.239
corr    1.00  .151  .132  .166  .195  .387  -.214  .476  .154  .187  .167  -.236  .410  .316  .370  .245
corr    1.00  .388  .479  .591  .294  -.171  .351  .102  .245  .180  .003  .274  .059  .178  .236
corr    1.00  .408  .437  .276  -.153  .353  .251  .318  .229  -.111  .263  .042  .203  .349
corr    1.00  .467  .234  -.249  .382  .199  .313  .197  -.117  .263  .047  .215  .318
corr    1.00  .368  -.199  .441  .198  .224  .197  -.099  .329  .105  .256  .322
corr    1.00  -.211  .473  .233  .253  .268  -.198  .397  .229  .309  .277
corr    1.00  -.310  -.217  -.312  -.203  .227  -.296  -.260  -.276  -.321
corr    1.00  .368  .350  .311  -.313  .578  .338  .521  .458
corr    1.00  .415  .580  -.588  .545  .497  .635  .683
corr    1.00  .570  -.386  .494  .340  .538  .524
corr    1.00  -.366  .427  .299  .498  .506
corr    1.00  -.684  -.620  -.746  -.568
corr    1.00  .759  .900  .555
corr    1.00  .814  .400
corr    1.00  .621
corr    1.00
end data .

factor  matrix in (cor = *)
    / analysis = cdi_actws_16 rdls_actws_16 cdi_actws_20 cdi_actws_26 rdls_actws_26 bnt_actws_36 bnt_actws_56
    / format = default
    / criteria = factors (1)
    / extraction = pc
    / rotation = norotate
    / print = initial extraction .

])

AT_CHECK([pspp -O format=csv correlation-matrix.sps], [0], [dnl
Table: Communalities
,Initial,Extraction
cdi_actws_16,1.000,.614
rdls_actws_16,1.000,.660
cdi_actws_20,1.000,.695
cdi_actws_26,1.000,.650
rdls_actws_26,1.000,.536
bnt_actws_36,1.000,.443
bnt_actws_56,1.000,.316

Table: Total Variance Explained
,Initial Eigenvalues,,,Extraction Sums of Squared Loadings,,
,Total,% of Variance,Cumulative %,Total,% of Variance,Cumulative %
1,3.914,55.9%,55.9%,3.914,55.9%,55.9%
2,1.320,18.9%,74.8%,,,
3,.716,10.2%,85.0%,,,
4,.422,6.0%,91.0%,,,
5,.278,4.0%,95.0%,,,
6,.216,3.1%,98.1%,,,
7,.135,1.9%,100.0%,,,

Table: Component Matrix
,Component
,1
cdi_actws_16,.784
rdls_actws_16,.812
cdi_actws_20,.834
cdi_actws_26,.806
rdls_actws_26,.732
bnt_actws_36,.666
bnt_actws_56,.562
])

AT_CLEANUP


AT_SETUP([FACTOR bad input])

dnl Test for a crash
AT_DATA([bad-input.sps], [dnl
set format = F10.3.
MATRIX DATA VARIABLES S1 ROWTYPE_ V1 TO V3 /SPLIT=S1.
BEGIN DATA
0 MEAN 2 4 3
0 SD 1 2 3
0 N 9 9 9
0 KORR 1
0 CORV .6 1
0 CORR .7 .8 1
1 MEAN 9 8 7
1 SD 5 6 7
1 N 9 9 9
1 CORR 1
X CORR .4 1
1 CORR .3 .2 1
END DATA.

EXECUTE.

FACTOR MATRIX IN (CORR =!*)
       /PRINT = CORRELATION
       .
])

AT_CHECK([pspp -O format=csv bad-input.sps], [1], [ignore])

AT_CLEANUP


AT_SETUP([FACTOR anti-image matrix])

AT_DATA([anti-image-matrix.sps], [dnl
SET FORMAT=F20.3 .
matrix data
 variables = rowtype_ viq piq pa ran piatwr  piatc
 / n = 476
 / format = lower diagonal .
begin data
mean  96.88  100.51  -1.73  -0.94  -2.52 -1.85
sd    10.97   11.19   1.19   0.88   0.85  0.97
corr    1.00
corr    0.38  1.00
corr    0.26  0.24  1.00
corr    0.16  0.17  0.34  1.00
corr    0.25  0.07  0.46  0.38  1.00
corr    0.37  0.22  0.39  0.30  0.59   1.00
end data.

factor matrix = in (cor = *)
 / analysis = viq piq pa ran piatwr piatc
 / format = sort
 / extraction = pc
 / rotation = norotate
 / print = aic
])

AT_CHECK([pspp -O format=csv anti-image-matrix.sps], [0], [dnl
Table: Anti-Image Matrices
,,viq,piq,pa,ran,piatwr,piatc
Anti-image Covariance,viq,.762,-.248,-.048,.008,-.031,-.143
,piq,-.248,.807,-.117,-.081,.108,-.071
,pa,-.048,-.117,.711,-.125,-.173,-.060
,ran,.008,-.081,-.125,.808,-.143,-.035
,piatwr,-.031,.108,-.173,-.143,.551,-.265
,piatc,-.143,-.071,-.060,-.035,-.265,.581
Anti-image Correlation,viq,.741,-.316,-.066,.011,-.048,-.215
,piq,-.316,.624,-.154,-.100,.163,-.103
,pa,-.066,-.154,.811,-.165,-.277,-.093
,ran,.011,-.100,-.165,.825,-.214,-.051
,piatwr,-.048,.163,-.277,-.214,.675,-.469
,piatc,-.215,-.103,-.093,-.051,-.469,.729

Table: Component Matrix
,Component,,,,
,1,2,3,4,5
piatc,.774,.122,-.368,.365,-.322
piatwr,.754,.418,.442,.219,-.115
pa,.707,.124,-.117,-.161,.256
piq,.456,-.733,.122,-.289,-.377
viq,.589,-.539,.033,.298,.457
ran,.592,.262,-.069,-.638,.096
])

AT_CLEANUP


AT_SETUP([FACTOR Kaiser-Meyer-Olkin])

AT_DATA([kmo.sps], [dnl
SET FORMAT=F20.3 .
matrix data
 variables = rowtype_ viq piq pa ran piatwr  piatc
 / n = 476
 / format = lower diagonal .
begin data
mean  96.88  100.51  -1.73  -0.94  -2.52 -1.85
sd    10.97   11.19   1.19   0.88   0.85  0.97
corr    1.00
corr    0.38  1.00
corr    0.26  0.24  1.00
corr    0.16  0.17  0.34  1.00
corr    0.25  0.07  0.46  0.38  1.00
corr    0.37  0.22  0.39  0.30  0.59   1.00
end data.

factor matrix = in (cor = *)
 / analysis = viq piq pa ran piatwr piatc
 / extraction = pc
 / rotation = norotate
 / print = kmo
])

AT_CHECK([pspp -O format=csv kmo.sps], [0], [dnl
Table: KMO and Bartlett's Test
Kaiser-Meyer-Olkin Measure of Sampling Adequacy,,.730
Bartlett's Test of Sphericity,Approx. Chi-Square,602.673
,df,15
,Sig.,.000

Table: Component Matrix
,Component,,,,
,1,2,3,4,5
viq,.589,-.539,.033,.298,.457
piq,.456,-.733,.122,-.289,-.377
pa,.707,.124,-.117,-.161,.256
ran,.592,.262,-.069,-.638,.096
piatwr,.754,.418,.442,.219,-.115
piatc,.774,.122,-.368,.365,-.322
])

AT_CLEANUP
